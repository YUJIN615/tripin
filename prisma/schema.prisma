// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 지역
model Region {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  places    Place[]
}

// 장소 캐시 (Kakao API 결과 저장)
model Place {
  id              Int      @id @default(autoincrement())
  regionId        Int
  region          Region   @relation(fields: [regionId], references: [id])
  kakaoPlaceId    String   @unique
  placeName       String
  categoryName    String?
  addressName     String?
  roadAddressName String?
  x               String
  y               String
  phone           String?
  tripType        String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([regionId, tripType])
}

// 일정 (사용자가 생성한 일정)
model Plan {
  id          Int         @id @default(autoincrement())
  region      String
  startDate   String      // ISO date string
  endDate     String      // ISO date string
  personCount Int
  tripTypes   Json      // JSON array string
  transports  Json      // JSON array string
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  days        PlanDay[]

  @@index([createdAt])
}

// 여행 (사용자가 저장한 일정)
model Trip {
  id          Int         @id @default(autoincrement())
  region      String
  startDate   String      // ISO date string
  endDate     String      // ISO date string
  personCount Int
  tripTypes   Json      // JSON array string
  transports  Json      // JSON array string
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  days        TripDay[]

  @@index([createdAt])
}

// 여행 일정의 각 날짜
model PlanDay {
  id        Int            @id @default(autoincrement())
  planId    Int
  plan      Plan           @relation(fields: [planId], references: [id], onDelete: Cascade)
  date      String         // ISO date string
  activities PlanActivity[]

  @@index([planId])
}

// 여행 일정의 각 날짜 (Trip용)
model TripDay {
  id        Int            @id @default(autoincrement())
  tripId    Int
  trip      Trip           @relation(fields: [tripId], references: [id], onDelete: Cascade)
  date      String         // ISO date string
  activities TripActivity[]

  @@index([tripId])
}

// 여행 일정의 각 활동
model PlanActivity {
  id                Int     @id @default(autoincrement())
  planDayId         Int
  planDay           PlanDay @relation(fields: [planDayId], references: [id], onDelete: Cascade)
  time              String
  activity          String
  placeName         String
  roadAddressName   String
  x                 String
  y                 String
  categoryName      String
  categoryGroupCode String
  categoryGroupName String
  phone             String?
  kakaoPlaceId      String

  @@index([planDayId])
}

// 여행 일정의 각 활동 (Trip용)
model TripActivity {
  id                Int     @id @default(autoincrement())
  tripDayId         Int
  tripDay           TripDay @relation(fields: [tripDayId], references: [id], onDelete: Cascade)
  time              String
  activity          String
  placeName         String
  roadAddressName   String
  x                 String
  y                 String
  categoryName      String
  categoryGroupCode String
  categoryGroupName String
  phone             String?
  kakaoPlaceId      String

  @@index([tripDayId])
}
